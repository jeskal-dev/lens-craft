---
import { Icon } from "astro-icon/components";
import Button from "../../ui/button.astro";
import { sessionTypes } from "../../../data/contact-form";
import Select from "../../ui/select.astro";
---

<section
  id="contact-hero"
  class="relative pt-28 md:pt-32 pb-20 bg-background overflow-hidden"
  aria-labelledby="contact-heading"
>
  <!-- Background gradient -->
  <div
    class="pointer-events-none absolute inset-x-0 -top-40 -z-10 h-80 bg-radial from-primary/14 via-background to-background opacity-90"
    aria-hidden="true"
  >
  </div>

  <!-- Floating decorative elements -->
  <div
    class="pointer-events-none absolute -right-20 top-1/4 -z-10 w-72 h-72 bg-primary/5 rounded-full blur-3xl"
  >
  </div>
  <div
    class="pointer-events-none absolute left-10 bottom-1/3 -z-10 w-48 h-48 bg-primary/5 rounded-full blur-3xl"
  >
  </div>

  <div class="container mx-auto px-4 sm:px-6">
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-12 lg:gap-16 items-start">
      <div class="lg:col-span-6 space-y-8">
        <div
          class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-primary/10 border border-primary/20 text-primary text-xs md:text-sm font-semibold uppercase tracking-[0.2em] motion-translate-y-in-20 motion-opacity-in-0 motion-duration-700"
        >
          <Icon name="lucide:mail" class="w-4 h-4" />
          <span>Contacto directo</span>
        </div>

        <header class="space-y-6">
          <h1
            id="contact-heading"
            class="text-4xl md:text-5xl lg:text-6xl font-serif font-bold tracking-tight leading-[1.1] text-foreground motion-translate-y-in-30 motion-opacity-in-0 motion-duration-800"
          >
            Conversemos sobre
            <span class="block text-primary italic mt-2">
              tu próxima sesión.
            </span>
          </h1>
          <p
            class="text-lg md:text-xl text-muted-foreground/90 leading-relaxed motion-translate-y-in-30 motion-opacity-in-0 motion-duration-800 motion-delay-150"
          >
            Completa el formulario para solicitar una reserva, pedir un
            presupuesto o plantear cualquier consulta. Respondemos habitualmente
            en menos de
            <span class="font-semibold text-foreground"
              >24 horas laborables</span
            >.
          </p>
        </header>

        <div
          class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 pt-8 border-t border-border/40 motion-opacity-in-0 motion-duration-800 motion-delay-250"
          aria-label="Información de contacto"
        >
          <div
            class="bg-card/50 border border-border/40 rounded-xl p-4 space-y-2 hover:border-primary/30 transition-colors"
          >
            <p
              class="text-xs font-bold uppercase tracking-widest text-muted-foreground flex items-center gap-2"
            >
              <Icon name="lucide:mail" class="w-3.5 h-3.5" />
              Email
            </p>
            <a
              href="mailto:hola@lenscraft.com"
              class="block text-sm md:text-base font-medium text-foreground hover:text-primary transition-colors"
            >
              hola@lenscraft.com
            </a>
          </div>

          <div
            class="bg-card/50 border border-border/40 rounded-xl p-4 space-y-2 hover:border-primary/30 transition-colors"
          >
            <p
              class="text-xs font-bold uppercase tracking-widest text-muted-foreground flex items-center gap-2"
            >
              <Icon name="lucide:phone" class="w-3.5 h-3.5" />
              Teléfono
            </p>
            <a
              href="tel:+34600000000"
              class="block text-sm md:text-base font-medium text-foreground hover:text-primary transition-colors"
            >
              +34 600 000 000
            </a>
          </div>

          <div
            class="bg-card/50 border border-border/40 rounded-xl p-4 space-y-2 hover:border-primary/30 transition-colors"
          >
            <p
              class="text-xs font-bold uppercase tracking-widest text-muted-foreground flex items-center gap-2"
            >
              <Icon name="lucide:map-pin" class="w-3.5 h-3.5" />
              Estudio
            </p>
            <p class="text-sm md:text-base font-medium text-foreground">
              Calle de las Artes, 12
              <span class="block text-muted-foreground text-xs mt-0.5">
                28001 Madrid, España
              </span>
            </p>
          </div>
        </div>

        <!-- CTA Section -->
        <div
          class="flex flex-col gap-6 items-start sm:items-center pt-8 motion-translate-y-in-30 motion-opacity-in-0 motion-duration-800 motion-delay-350"
        >
          <Button
            href="/services"
            variant="outline"
            size="md"
            rounded="lg"
            class="w-full justify-center"
          >
            <Icon name="lucide:package" class="w-4 h-4 mr-2" />
            Ver paquetes y precios
          </Button>
          <div class="flex items-center gap-3">
            <div class="mt-0.5 p-1 rounded-full bg-green-500/10">
              <Icon name="lucide:shield-check" class="w-4 h-4 text-green-500" />
            </div>
            <p class="text-sm text-muted-foreground">
              <span class="font-medium text-foreground"
                >Protegemos tus datos.</span
              >
              Tratamiento confidencial según la ley de protección de datos.
            </p>
          </div>
        </div>
      </div>

      <div
        class="lg:col-span-6 motion-scale-in-95 motion-opacity-in-0 motion-duration-800 motion-delay-300"
      >
        <div class="sticky top-32">
          <div
            class="bg-linear-to-br from-card via-card to-card/95 border border-border/60 rounded-2xl p-6 md:p-8 shadow-2xl shadow-black/10 space-y-8 backdrop-blur-sm"
          >
            <div class="space-y-2">
              <div class="flex items-center gap-3">
                <div class="p-2 rounded-lg bg-primary/10">
                  <Icon
                    name="lucide:message-square"
                    class="w-6 h-6 text-primary"
                  />
                </div>
                <h2
                  class="text-2xl md:text-3xl font-serif font-semibold text-foreground"
                >
                  Formulario de contacto
                </h2>
              </div>
              <p
                id="contact-form-description"
                class="text-sm text-muted-foreground"
              >
                Indícanos algunos detalles para poder responderte con una
                propuesta personalizada.
              </p>
            </div>

            <form
              id="contact-form"
              class="space-y-6"
              novalidate
              aria-describedby="contact-form-description contact-form-status"
            >
              <!-- Name & Email -->
              <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                <div class="space-y-2">
                  <label
                    for="name"
                    class="text-xs font-semibold uppercase tracking-wider text-muted-foreground flex items-center gap-2"
                  >
                    <Icon name="lucide:user" class="w-3.5 h-3.5" />
                    Nombre completo
                  </label>
                  <input
                    id="name"
                    name="name"
                    type="text"
                    required
                    autocomplete="name"
                    data-field="text"
                    class="contact-input"
                    placeholder="Cómo podemos llamarte"
                  />
                  <p
                    class="error-message"
                    data-error-for="name"
                    aria-live="polite"
                  >
                  </p>
                </div>

                <div class="space-y-2">
                  <label
                    for="email"
                    class="text-xs font-semibold uppercase tracking-wider text-muted-foreground flex items-center gap-2"
                  >
                    <Icon name="lucide:mail" class="w-3.5 h-3.5" />
                    Email
                  </label>
                  <input
                    id="email"
                    name="email"
                    type="email"
                    inputmode="email"
                    required
                    autocomplete="email"
                    data-field="email"
                    class="contact-input"
                    placeholder="tucorreo@email.com"
                  />
                  <p
                    class="error-message"
                    data-error-for="email"
                    aria-live="polite"
                  >
                  </p>
                </div>
              </div>

              <!-- Custom Select -->
              <div class="space-y-2">
                <label
                  for="sessionType"
                  class="text-xs font-semibold uppercase tracking-wider text-muted-foreground flex items-center gap-2"
                >
                  <Icon name="lucide:camera" class="w-3.5 h-3.5" />
                  Tipo de sesión
                </label>

                <Select
                  id="sessionType"
                  name="sessionType"
                  required
                  data-field="select"
                  options={sessionTypes}
                  placeholder="Selecciona una opción"
                />

                <p
                  class="error-message"
                  data-error-for="sessionType"
                  aria-live="polite"
                >
                </p>
              </div>

              <!-- Message -->
              <div class="space-y-2">
                <label
                  for="message"
                  class="text-xs font-semibold uppercase tracking-wider text-muted-foreground flex items-center gap-2"
                >
                  <Icon name="lucide:edit" class="w-3.5 h-3.5" />
                  Mensaje
                </label>
                <textarea
                  id="message"
                  name="message"
                  required
                  rows={5}
                  data-field="textarea"
                  class="contact-input min-h-30 resize-y"
                  placeholder="Cuéntanos fecha, lugar y cualquier detalle relevante de tu sesión..."
                ></textarea>
                <p
                  class="error-message"
                  data-error-for="message"
                  aria-live="polite"
                >
                </p>
              </div>

              <!-- Privacy & Submit -->
              <div class="space-y-6 pt-4 border-t border-border/40">
                <div class="flex items-start gap-3">
                  <div class="relative mt-0.5 flex flex-col items-center">
                    <input
                      id="privacy"
                      name="privacy"
                      type="checkbox"
                      required
                      data-field="checkbox"
                      class="appearance-none h-5 w-5 rounded border border-border bg-background checked:bg-primary checked:border-primary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/50 transition-colors peer"
                    />
                    <Icon
                      name="lucide:check"
                      class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 size-4text-white pointer-events-none opacity-0 peer-checked:opacity-100"
                      data-check-icon
                    />
                  </div>
                  <label
                    for="privacy"
                    class="text-sm text-muted-foreground leading-relaxed"
                  >
                    Acepto que mis datos sean utilizados para responder a mi
                    consulta, de acuerdo con la
                    <a
                      href="/privacy"
                      class="text-primary hover:text-primary/80 underline underline-offset-2 transition-colors"
                    >
                      política de privacidad
                    </a>.
                  </label>
                </div>
                <p
                  class="error-message"
                  data-error-for="privacy"
                  aria-live="polite"
                >
                </p>

                <Button
                  type="submit"
                  size="lg"
                  rounded="full"
                  fullWidth
                  withIcon
                  iconPosition="right"
                  class="group"
                  data-submit-button
                >
                  <span>Enviar mensaje</span>
                </Button>

                <div
                  id="contact-form-status"
                  class="text-sm min-h-6 text-center"
                  aria-live="polite"
                >
                </div>
              </div>
            </form>
          </div>

          <!-- Form Success State (hidden by default) -->
          <div
            id="success-state"
            class="hidden bg-linear-to-br from-green-500/10 via-card to-card/95 border border-green-500/20 rounded-2xl p-8 text-center space-y-4 motion-scale-in-95"
          >
            <div
              class="w-16 h-16 rounded-full bg-green-500/10 flex items-center justify-center mx-auto"
            >
              <Icon
                name="lucide:check-circle"
                class="w-10 h-10 text-green-500"
              />
            </div>
            <h3 class="text-2xl font-serif font-semibold text-foreground">
              ¡Mensaje enviado!
            </h3>
            <p class="text-muted-foreground">
              Te responderemos en menos de <span
                class="font-semibold text-foreground">24 horas laborables</span
              >.
            </p>
            <Button
              href="/"
              variant="ghost"
              size="lg"
              rounded="full"
              class="mt-4"
            >
              Volver al inicio
            </Button>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<style is:global>
  @reference '../../../styles/global.css';

  .contact-input {
    @apply w-full rounded-xl border border-border bg-background/80 px-4 py-3.5 text-sm md:text-base text-foreground placeholder:text-muted-foreground/60 focus-visible:outline-none focus-visible:border-primary/50 focus-visible:ring-2 focus-visible:ring-primary/20 focus-visible:ring-offset-2 focus-visible:ring-offset-background transition-all duration-200;
  }

  .contact-input:focus {
    @apply bg-background;
  }

  .error-message {
    @apply mt-1.5 text-xs text-destructive min-h-5 font-medium;
  }

  input[aria-invalid="true"],
  textarea[aria-invalid="true"],
  [data-field="select"][aria-invalid="true"] {
    @apply border-destructive/50 focus-visible:border-destructive focus-visible:ring-destructive/20;
  }

  input:checked {
    @apply bg-primary border-primary;
  }
</style>

<script>
  // This will be handled by the TypeScript module
  // We'll just initialize the form
  document.addEventListener("DOMContentLoaded", () => {
    import("../../../scripts/contact-form").then((module) => {
      module.initContactForm();
    });
  });
</script>
