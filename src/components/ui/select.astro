---
import { Icon } from "astro-icon/components";
import type { SelectOption } from "../../types/contact.types";

interface Props {
  id: string;
  name: string;
  required?: boolean;
  options: SelectOption[];
  placeholder?: string;
  "data-field"?: string;
}

const {
  id,
  name,
  required = false,
  options,
  placeholder = "Selecciona una opci√≥n",
  "data-field": dataField = "select",
} = Astro.props;
---

<div class="custom-select relative" data-custom-select data-field={dataField}>
  <button
    type="button"
    id={`${id}-trigger`}
    class="contact-input flex items-center justify-between w-full text-left cursor-pointer"
    aria-haspopup="listbox"
    aria-expanded="false"
    aria-labelledby={`${id}-label`}
  >
    <span class="selected-value text-foreground truncate" data-selected-value>
      {placeholder}
    </span>
    <Icon
      name="lucide:chevron-down"
      class="w-4 h-4 text-muted-foreground shrink-0 transition-transform duration-200"
      data-chevron
    />
  </button>

  <input
    type="hidden"
    id={id}
    name={name}
    required={required}
    value=""
    data-select-input
  />

  <div
    class="select-dropdown absolute top-full left-0 right-0 z-50 mt-1 max-h-60 overflow-y-auto rounded-xl border border-border bg-card shadow-2xl shadow-black/20 backdrop-blur-sm opacity-0 invisible transition-all duration-200 transform -translate-y-2"
    role="listbox"
    aria-labelledby={`${id}-label`}
    data-dropdown
  >
    {
      options.map((option) => (
        <button
          type="button"
          class="w-full px-4 py-3 text-left text-sm text-foreground hover:bg-primary/5 transition-colors first:rounded-t-xl last:rounded-b-xl"
          role="option"
          data-value={option.value}
          data-label={option.label}
          onclick={`window.handleSelectOption('${id}', '${option.value}', '${option.label}')`}
        >
          <div class="flex items-center gap-3">
            {option.icon && (
              <Icon name={option.icon} class="w-4 h-4 text-primary shrink-0" />
            )}
            <span>{option.label}</span>
          </div>
        </button>
      ))
    }
  </div>
</div>

<style>
  @reference '../../styles/global.css';

  .custom-select {
    @apply relative;
  }

  .select-dropdown {
    scrollbar-width: thin;
    scrollbar-color: hsl(var(--muted)) transparent;
  }

  .select-dropdown::-webkit-scrollbar {
    width: 6px;
  }

  .select-dropdown::-webkit-scrollbar-track {
    background: transparent;
    border-radius: 0 4px 4px 0;
  }

  .select-dropdown::-webkit-scrollbar-thumb {
    background: hsl(var(--muted));
    border-radius: 3px;
  }

  .select-dropdown[data-visible="true"] {
    @apply opacity-100 visible transform translate-y-0;
  }

  button[aria-expanded="true"] [data-chevron] {
    transform: rotate(180deg);
  }
</style>
